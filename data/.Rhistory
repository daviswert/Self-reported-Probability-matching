demo()
install.packages("rmarkdown")
install.packages("tidyr")
install.packages("dplyr")
install.packages("ggplot2")
installed.packages()
df<-read.table("bandit1-trials.tsv",header=T)
install.package(MASS)
install.packages(MASS)
help
help(aov)
help(sample)
help subset
help(subset)
help(to)
source("C:/Users/Davis/Downloads/Ranalysis-master/Ranalysis-master/useful.R")
setwd("../data/")
library(MASS)
library(lme4)
source("C:/Users/Davis/Downloads/Ranalysis-master/Ranalysis-master/useful.R")
setwd("../data/")
#setwd("D:/Git/Self-reported-Probability-matching/data")
df<-read.table('bandit1-trials.tsv',header=T,stringsAsFactors=FALSE)
#trimming the df table to exclude the prevalence answers
trim<-subset(df, trial_type=="multi_trial")
#new column with timeouts registered as Incorrect
trim$rs_timeOutWrong<-trim$result
trim[which(trim$result==-1),]$rs_timeOutWrong<-0
#new column indicating correct bias-matching
trim$bias_match<-ifelse(trim$response==trim$bias_direction,1,0)
#aggregating over subjects - currently not used
subj_aggr <- ddply(trim, .(workerid), summarise,
bias=sample(bias,1),
bias_direction=sample(bias_direction,1),
rt=mean(rt),
rs_acc=mean(rs_timeOutWrong),
match_acc=mean(bias_match))
#forming cumulative metrics for each subject
score_aggr<-ddply(trim, .(workerid), mutate,
relative_prop = cumsum(bias_match)/to.n(trial),
trial=to.n(trial),
relative_left = cumsum(response=='L')/to.n(trial),
bias = factor(bias),
Lbias = factor(Lbias),
biasDir = factor(bias_direction))
#forming cumulative metrics for each trial
trial_aggr<-ddply(trim, .(trial,bias), summarise,
no_correct = sum(bias_match),
no_total = length(unique(workerid)))
trial_aggr$trial_no<-to.n(trial_aggr$trial)
trial_aggr$subj_proportion<-trial_aggr$no_correct/trial_aggr$no_total
trial_aggr<-trial_aggr[order(trial_aggr$bias,trial_aggr$trial_no),]
trial_aggr<-mutate(group_by(trial_aggr,bias), aggr_acc=cumsum(subj_proportion)/trial_no)
#setwd("../data/")
setwd("D:/Git/Self-reported-Probability-matching/data")
df<-read.table('bandit1-trials.tsv',header=T,stringsAsFactors=FALSE)
#trimming the df table to exclude the prevalence answers
trim<-subset(df, trial_type=="multi_trial")
#new column with timeouts registered as Incorrect
trim$rs_timeOutWrong<-trim$result
trim[which(trim$result==-1),]$rs_timeOutWrong<-0
#new column indicating correct bias-matching
trim$bias_match<-ifelse(trim$response==trim$bias_direction,1,0)
#aggregating over subjects - currently not used
subj_aggr <- ddply(trim, .(workerid), summarise,
bias=sample(bias,1),
bias_direction=sample(bias_direction,1),
rt=mean(rt),
rs_acc=mean(rs_timeOutWrong),
match_acc=mean(bias_match))
#forming cumulative metrics for each subject
score_aggr<-ddply(trim, .(workerid), mutate,
relative_prop = cumsum(bias_match)/to.n(trial),
trial=to.n(trial),
relative_left = cumsum(response=='L')/to.n(trial),
bias = factor(bias),
Lbias = factor(Lbias),
biasDir = factor(bias_direction))
#forming cumulative metrics for each trial
trial_aggr<-ddply(trim, .(trial,bias), summarise,
no_correct = sum(bias_match),
no_total = length(unique(workerid)))
trial_aggr$trial_no<-to.n(trial_aggr$trial)
trial_aggr$subj_proportion<-trial_aggr$no_correct/trial_aggr$no_total
trial_aggr<-trial_aggr[order(trial_aggr$bias,trial_aggr$trial_no),]
trial_aggr<-mutate(group_by(trial_aggr,bias), aggr_acc=cumsum(subj_proportion)/trial_no)
subset(ddply(df, c("workerid"), summarise, N = length(rt)), N!=54)
subset(ddply(trim, c("result"), summarise, N=length(rt)))
qplot(data=df[which(df$trial_type=="multi_trial"),], x=rt/1000, geom='histogram')+
facet_wrap(~bias)+
ylab("Count")+
xlab("Reaction Time (seconds)")
qplot(data=df[which(df$trial_type=="elicit_prevalence"),], x=rt/1000, geom='histogram')+
facet_wrap(~bias)+
ylab("Count")+
xlab("Reaction Time (seconds)")
trim$bias_match <- factor(trim$bias_match)
ggplot(trim, aes(x=bias_match, y=rt/1000, fill = bias_match))+
geom_boxplot()+
guides(fill=FALSE)
ggplot(trim, aes(x=bias_match, y=rt/1000, fill = bias_match))+
geom_boxplot()+
guides(fill=FALSE)+
xlab()
trim$bias_match <- factor(trim$bias_match)
ggplot(trim, aes(x=bias_match, y=rt/1000, fill = bias_match))+
geom_boxplot()+
guides(fill=FALSE)+
xlab(" ")
ggplot(trim, aes(x=bias_match, y=rt/1000, fill = bias_match))+
geom_boxplot()+
guides(fill=FALSE)+
xlab(" ")+
scale_x_discrete(limits=bias_match,labels=c("Nonmatch","Match"))
ggplot(trim, aes(x=bias_match, y=rt/1000, fill = bias_match))+
geom_boxplot()+
guides(fill=FALSE)+
xlab(" ")+
scale_x_discrete(limits=trim$bias_match,labels=c("Nonmatch","Match"))
ggplot(trim, aes(x=bias_match, y=rt/1000, fill = bias_match))+
geom_boxplot()+
guides(fill=FALSE)+
xlab(" ")+
scale_x_discrete(labels=c("Nonmatch","Match"))
ggplot(trim, aes(x=bias_match, y=rt/1000, fill = bias_match))+
geom_boxplot()+
guides(fill=FALSE)+
xlab(" ")+
ylab("RT (seconds)")
scale_x_discrete(labels=c("Nonmatch","Match"))
ggplot(trim, aes(x=bias_match, y=rt/1000, fill = bias_match))+
geom_boxplot()+
guides(fill=FALSE)+
xlab(" ")+
ylab("RT (seconds)")+
ggtitle("Distribution of RTs for Matching vs Nonmatching Responses")
ggplot(trim, aes(x=bias_match, y=rt/1000, fill = bias_match))+
geom_boxplot()+
guides(fill=FALSE)+
xlab(" ")+
ylab("RT (seconds)")+
ggtitle("Distribution of RTs for Matching vs Nonmatching Responses")+
scale_x_discrete(labels=c("Nonmatch","Match"))
ggplot(trim, aes(x=rt/1000, fill = bias_match))+
geom_histogram()+
guides(fill=FALSE)+
facet_grid(bias~bias_match)
rs<-glm(data=trim, bias_match ~ rt, family='binomial')
summary(rs)
rs<-lm(data=trim, rt ~ bias_match + bias)
summary(rs)
rs<-lm(data=trim, rt ~ bias_match * bias)
summary(rs)
trim$bias<-factor(trim$bias)
rs<-lm(data=trim, rt ~ bias_match * bias)
summary(rs)
contrasts(trim$bias)
contrasts(trim$bias_match)
rs<-lmer(data=trim, rt ~ bias_match*bias + (1 + bias_match | workerid))
summary(rs)
ggplot(subj_aggr, aes(x=rt/1000, y=match_acc))+
geom_point(shape=1)+
facet_wrap(~bias)+
geom_smooth(method=lm)
ggplot(subj_aggr, aes(x=rt/1000, y=match_acc))+
geom_point(shape=1)+
facet_wrap(~bias)+
geom_smooth(method=lm)+
ylab("Matching Rate")
subj_aggr %>%
group_by(bias) %>%
summarise(correlation = cor(rt,match_acc))
rs<-lm(data=subj_aggr, rt ~ match_acc*bias)
summary(rs)
rs<-lm(data=subj_aggr, rt ~ match_acc+bias)
summary(rs)
trim$bias_direction <- factor(trim$bias_direction)
trim$bias_match <- to.n(trim$bias_match)
bias_dir<-ddply(trim, .(bias, bias_direction), summarise,
N = length(unique(workerid)),
rt = mean(rt),
rs_acc = mean(result),
match_acc = mean(bias_match),
sterr = sem(bias_match))
ggplot(data=bias_dir, aes(x=bias, y=match_acc, fill=bias_direction))+
geom_bar(stat='identity', position=position_dodge(0.5), width=0.5)+
geom_errorbar(aes(ymax = match_acc + 2*sterr, ymin= match_acc-2*sterr), position=position_dodge(0.5),width=0.3)+
ylim(0,1)+
ylab("Bias Matching Rate")+
xlab("Bias Level")
ggplot(score_aggr, aes(x=trial, y=relative_left, group=workerid, color=workerid))+
geom_line(size=1)+
ylab("relative L responses")+
facet_wrap(~Lbias)+
guides(color=F)
trim$workerid <- factor(trim$workerid)
ggplot(score_aggr, aes(x=trial, y=relative_left, group=workerid, color=workerid))+
geom_line(size=1)+
ylab("relative L responses")+
facet_wrap(~Lbias)+
guides(color=F)
score_aggr$workerid <- factor(score_aggr$workerid)
ggplot(score_aggr, aes(x=trial, y=relative_left, group=workerid, color=workerid))+
geom_line(size=1)+
ylab("relative L responses")+
facet_wrap(~Lbias)+
guides(color=F)
ggplot(score_aggr, aes(x=trial, y=relative_left, group=workerid, color=workerid))+
geom_line(size=1)+
ylab("relative L responses")+
facet_wrap(~Lbias)+
guides(color=T)
ggplot(score_aggr, aes(x=trial, y=relative_left, group=workerid, color=workerid))+
geom_line(size=1)+
ylab("relative L responses")+
facet_wrap(~Lbias)
rs_dir<-ddply(trim, c("response"), summarise,
N=length(rt))
qplot(response, N, data=rs_dir, geom='bar', stat='identity')
num60 = length(unique(trim[which(bias = '60')$workerid))
num60 = length(unique(trim[which(bias = '60'),]$workerid))
num60 = length(unique(trim[which(bias == '60'),]$workerid))
num60 = length(unique(trim[which(trim$bias == '60'),]$workerid))
nL60 = length(unique(trim[which(trim$bias_direction == 'L' && trim$bias == '60'),]$workerid))
nL60 = length(unique((trim[which(trim$bias_direction == 'L' && trim$bias == '60'),])$workerid))
nL60 = length(unique((trim[which(trim$bias_direction == 'L' && trim$bias == 60),])$workerid))
nL60 = length(unique((trim)$workerid))
nL60 = length(unique((trim[which(trim$bias_direction == 'L' && to.n(trim$bias) == 60),])$workerid))
nL60 = length(unique((trim[which(trim$bias_direction == 'L' && trim$bias == 1),])$workerid))
nL60 = length(unique((trim[which(trim$bias_direction == 'L' && to.n(trim$bias) == 1),])$workerid))
trim$bias
to.n(trim$bias)
temp = ddply(trial_aggr[which(trial_aggr$bias_direction=='L'),], summarise,
N=N)
temp
temp <- ddply(trial_aggr[which(trial_aggr$bias_direction=='L'),], summarise,
N=N)
temp
temp <- ddply(trial_aggr[which(trial_aggr$bias_direction=='L'),], summarise,
N=N)
rs_dir<-ddply(trim, c("response"), summarise,
N=length(rt))
temp <- ddply(trial_aggr[which(trial_aggr$bias_direction=='L'),], .(bias), summarise,
N=N)
temp
nL = length(unique(trim[which(Lbias=="20"),]$workerid))
nL = length(unique(trim[which(trim$Lbias=="20"),]$workerid))
nL = length(trim[which(trim$Lbias=="20"),])
nR = length(trim[which(trim$Lbias=="40"),])
nR = length(trim[which(trim$Lbias=="80"),])
nR = trim[which(trim$Lbias=="80"),])
nR <- length(trim[which(trim$Lbias=="80"),])
ggplot(score_aggr, aes(x=trial, y=relative_prop, group=workerid, color=workerid))+
geom_line(size=1)+
ylab("relative proportion matched")+
facet_wrap(~bias)+
guides(color=F)
ggplot(data=trial_aggr,aes(x=trial_no,y=subj_proportion))+
geom_line(size=1.5)+
facet_wrap(~bias)
ggplot(trial_aggr, aes(x=trial_no,y=aggr_acc))+
geom_line(size=1)+
ylim(0,1)+
ylab("Match Accuracy")+
facet_wrap(~bias)
ggplot(trial_aggr, aes(x=trial_no,y=aggr_acc))+
geom_line(size=1)+
ylim(0,1)+
ylab("Mean Cumulative Match Accuracy")+
facet_wrap(~bias)
ggplot(subj_aggr, aes(x=factor(bias), y=match_acc, fill=factor(bias)))+
geom_boxplot()+
guides(fill=FALSE)
prev<-df[which(df$trial_type=="elicit_prevalence"), c('workerid', 'rt', 'Lbias', 'bias', 'trial', 'response')]
score1<-prev[which(prev$trial=="catch1"),]$response=="2"
score2<-prev[which(prev$trial=="catch2"),]$response=="2"
score3<-prev[which(prev$trial=="catch3"),]$response=="50"
subj_prev <- prev[which(prev$trial=="prevalence"), c('workerid', 'Lbias', 'bias', 'response')]
subj_prev$catch_score <- score1+score2+score3
subj_prev$off_by <- abs(as.numeric(subj_prev$response) - 100*subj_prev$Lbias)
subj_prev$trial_acc <- subj_aggr$match_acc
#Match accuracy as a measure of reporting accuracy. Oh dear.
ggplot(subj_prev, aes(x=trial_acc,y=off_by))+
geom_point(shape=1)+
geom_smooth(method=lm)
ggplot(subj_prev, aes(x=trial_acc,y=off_by))+
geom_point(shape=1)+
geom_smooth(method=lm)+
xlab("Total Match Accuracy")+
ylab("Reporting Discrepancy")
ggplot(subj_prev, aes(x=trial_acc,y=off_by))+
geom_point(shape=1)+
geom_smooth(method=lm)+
xlab("Total Match Accuracy")+
ylab("Distance from Correct Error (%)")
ggplot(subj_prev, aes(x=trial_acc,y=off_by))+
geom_point(shape=1)+
geom_smooth(method=lm)+
facet_wrap(~catch_score, scales='free')
ggplot(subj_prev, aes(x=trial_acc,y=off_by))+
geom_point(shape=1)+
geom_smooth(method=lm)+
facet_wrap(~bias)
ggplot(subj_prev, aes(x=trial_acc,y=off_by))+
geom_point(shape=1)+
geom_smooth(method=lm)+
facet_wrap(~bias)+
xlab("Total Match Accuracy")+
ylab("Distance from Correct Percentage (%)")
